const translations = {
    de: {
        // Navigation
        nav_how: "So funktioniert's",
        nav_faq: "FAQ",
        nav_about: "Ãœber uns",
        nav_legal: "Impressum & AGB",
        nav_back: "â† ZurÃ¼ck zur Startseite",
        
        // Hero
        hero_title_pre: "Lerne mit der",
        hero_title_highlight: "KI,",
        hero_subtitle_pre: "die",
        hero_subtitle_highlight: "schÃ¶ne Notizen",
        hero_subtitle_post: "erstellt",
        
        // Steps
        step_1_heading: "Starte, wo du es brauchst",
        step_1_content: "Lade ein Foto vom Arbeitsblatt oder dem Buch hoch, oder sag der KI, was du nicht gecheckt hast. Wir erkennen das Thema und helfen dir, genau wo du es brauchst.",
        step_2_heading: "Lern mit der KI",
        step_2_content: "Du sprichst im (Voice-)chat mit der KI. Gemeinsam lÃ¶st ihr Aufgaben (deine mitgebrachten, oder von der KI ausgesuchte), und du erhÃ¤ltst geduldge ErklÃ¤rungen und Antworten auf all deine Fragen.",
        step_3_heading: "Nimm die Mitschrift mit!",
        step_3_content: "WÃ¤hrend dem Lernen erstellt die KI strukturierte Notizen mit Visualisierungen fÃ¼r dich. Du kannst sie jederzeit bearbeiten und zum Lernen runterladen.",
        
        // Examples
        examples_title: "Wann hilft dir das?",
        example_1_text: "\"Ich versteh die Hausaufgaben nicht\"",
        example_1_highlight: "â†’ Hochladen & gemeinsam lÃ¶sen",
        example_2_text: "\"Der Test ist morgen\"",
        example_2_highlight: "â†’ Gezielte Vorbereitung",
        example_3_text: "\"Ich will eine Sprache lernen\"",
        example_3_highlight: "â†’ Konversation & Vokabeln Ã¼ben",
        example_4_text: "\"Ich hÃ¤ng total hinterher\"",
        example_4_highlight: "â†’ Aufholen in deinem Tempo",
        
        // Pricing
        cta_sticker: "Gratis testen",
        price_highlight: "Dann 2.99â‚¬/Woche",
        price_sub: "Jederzeit kÃ¼ndbar",
        cta_button_secondary: "â†’ Kostenlos testen",
        
        // So funktioniert's Page
        how_title: "So funktioniert's",
        how_step_1_title: "Schritt 1: Problem teilen",
        how_step_1_text: "Mach einfach ein Foto von deiner Aufgabe oder tippe deine Frage ein. Egal ob Mathe, Geschichte oder Sprachen - wir sind bereit.",
        how_step_2_title: "Schritt 2: Interaktiver Dialog",
        how_step_2_text: "Die KI erklÃ¤rt dir nicht nur die LÃ¶sung, sondern fÃ¼hrt dich Schritt fÃ¼r Schritt hin. Du kannst jederzeit nachfragen, wenn du etwas nicht verstehst.",
        how_step_3_title: "Schritt 3: Perfekte Notizen",
        how_step_3_text: "Am Ende erhÃ¤ltst du eine wunderschÃ¶ne, strukturierte Zusammenfassung deiner Lernsession als PDF oder Bild. Perfekt zum Wiederholen!",

        // FAQ Page
        faq_title: "HÃ¤ufige Fragen (FAQ)",
        faq_q1: "Ist tutor.new wirklich kostenlos?",
        faq_a1: "Du kannst tutor.new kostenlos ausprobieren! FÃ¼r unbegrenzten Zugang und alle Premium-Features gibt es ein faires monatliches Abo.",
        faq_q2: "Welche FÃ¤cher werden unterstÃ¼tzt?",
        faq_a2: "Wir unterstÃ¼tzen fast alle SchulfÃ¤cher, von Mathematik und Physik Ã¼ber Deutsch und Englisch bis hin zu Geschichte und Biologie.",
        faq_q3: "Kann ich meine Notizen speichern?",
        faq_a3: "Ja! Alle erstellten Lernnotizen werden in deinem Profil gespeichert und du kannst sie jederzeit wieder aufrufen oder herunterladen.",
        faq_q4: "Ist die KI immer richtig?",
        faq_a4: "Unsere KI ist sehr fortgeschritten, aber wie auch echte Lehrer kÃ¶nnen Fehler passieren. Wir arbeiten stÃ¤ndig daran, die Genauigkeit zu verbessern.",
        
        // About Page
        about_title: "Ãœber tutor.new",
        about_intro_heading: "Hallo! ðŸ‘‹ðŸ»",
        about_intro_text: "Wir sind Gero und Friedrich, ein Informatiker und ein Mathematiker. Wir haben uns kennengelernt, als wir beide an der ETH ZÃ¼rich studierten und schnell gemerkt, dass wir beide Technologie nutzen wollen, um groÃŸartige Lernerfahrungen zu schaffen. Das war der Beginn von tutor.new ...",
        about_history_heading: "Unsere Geschichte",
        about_history_p1: "Wir beide hatten schon immer eine Leidenschaft fÃ¼rs Unterrichten. WÃ¤hrend unseres Studiums an der ETH ZÃ¼rich stellten wir fest, dass viele Studierende nicht kÃ¤mpften, weil ihnen die FÃ¤higkeiten fehlten, sondern weil sie personalisierte Aufmerksamkeit und UnterstÃ¼tzung brauchten, die traditionelle Bildungssysteme nicht bieten konnten.",
        about_history_p2: "Wir erkannten, dass KI-Technologie diese LÃ¼cke schlieÃŸen kÃ¶nnte - intelligente Tutoren schaffen, die sich an den einzigartigen Lernstil, das Tempo und die BedÃ¼rfnisse jedes SchÃ¼lers anpassen. So entstand tutor.new.",
        about_history_p3: "Heute sind wir stolz darauf, SchÃ¼lern aller Bildungsebenen dabei zu helfen, ihre Ziele durch personalisierte KI-Nachhilfe zu erreichen.",
        
        // Legal Page
        legal_title: "Rechtliches",
        legal_imprint_heading: "Impressum",
        legal_terms_heading: "AGB (Terms & Conditions)",
        legal_privacy_heading: "DatenschutzerklÃ¤rung",

        // Footer/Misc
        footer_copyright: "Â© 2023 tutor.new" // Example if needed
    },
    en: {
        // Navigation
        nav_how: "How it works",
        nav_faq: "FAQ",
        nav_about: "About us",
        nav_legal: "Legal & Terms",
        nav_back: "â† Back to home",
        
        // Hero
        hero_title_pre: "Learn with the",
        hero_title_highlight: "AI",
        hero_subtitle_pre: "that creates",
        hero_subtitle_highlight: "beautiful notes",
        hero_subtitle_post: "", // Empty in English structure if needed, or adjust flow
        
        // Steps
        step_1_heading: "Start where you need it",
        step_1_content: "Upload a photo of your worksheet or book, or tell the AI what you didn't get. We identify the topic and help you exactly where you need it.",
        step_2_heading: "Learn with the AI",
        step_2_content: "You talk in (voice) chat with the AI. Together you solve problems (yours or ones picked by the AI), and you get patient explanations and answers to all your questions.",
        step_3_heading: "Take the notes with you!",
        step_3_content: "While learning, the AI creates structured notes with visualizations for you. You can edit them anytime and download them to study.",
        
        // Examples
        examples_title: "When does this help?",
        example_1_text: "\"I don't understand the homework\"",
        example_1_highlight: "â†’ Upload & solve together",
        example_2_text: "\"The test is tomorrow\"",
        example_2_highlight: "â†’ Targeted preparation",
        example_3_text: "\"I want to learn a language\"",
        example_3_highlight: "â†’ Practice conversation & vocab",
        example_4_text: "\"I'm totally behind\"",
        example_4_highlight: "â†’ Catch up at your own pace",
        
        // Pricing
        cta_sticker: "Try for free",
        price_highlight: "Then $2.99/Week", // Will be replaced with locale-based currency
        price_sub: "Cancel anytime",
        cta_button_secondary: "â†’ Try for free",
        
        // So funktioniert's Page
        how_title: "How it works",
        how_step_1_title: "Step 1: Share the problem",
        how_step_1_text: "Just take a photo of your task or type in your question. Whether math, history, or languages - we are ready.",
        how_step_2_title: "Step 2: Interactive Dialogue",
        how_step_2_text: "The AI doesn't just explain the solution, but guides you step by step. You can ask follow-up questions anytime if you don't understand something.",
        how_step_3_title: "Step 3: Perfect Notes",
        how_step_3_text: "At the end, you get a beautiful, structured summary of your learning session as a PDF or image. Perfect for reviewing!",

        // FAQ Page
        faq_title: "Frequently Asked Questions",
        faq_q1: "Is tutor.new really free?",
        faq_a1: "You can try tutor.new for free! For unlimited access and all premium features, there is a fair monthly subscription.",
        faq_q2: "Which subjects are supported?",
        faq_a2: "We support almost all school subjects, from Mathematics and Physics to German and English, as well as History and Biology.",
        faq_q3: "Can I save my notes?",
        faq_a3: "Yes! All created study notes are saved in your profile and you can access or download them at any time.",
        faq_q4: "Is the AI always right?",
        faq_a4: "Our AI is very advanced, but like real teachers, mistakes can happen. We are constantly working to improve accuracy.",
        
        // About Page
        about_title: "About tutor.new",
        about_intro_heading: "Hello! ðŸ‘‹ðŸ»",
        about_intro_text: "We are Gero and Friedrich, a computer scientist and a mathematician. We met while studying at ETH Zurich and quickly realized that we both wanted to use technology to create great learning experiences. That was the beginning of tutor.new ...",
        about_history_heading: "Our Story",
        about_history_p1: "We both always had a passion for teaching. During our studies at ETH Zurich, we noticed that many students struggled not because they lacked the ability, but because they needed personalized attention and support that traditional education systems couldn't provide.",
        about_history_p2: "We realized that AI technology could bridge this gap - creating intelligent tutors that adapt to each student's unique learning style, pace, and needs. Thus, tutor.new was born.",
        about_history_p3: "Today, we are proud to help students of all education levels achieve their goals through personalized AI tutoring.",

        // Legal Page
        legal_title: "Legal",
        legal_imprint_heading: "Imprint",
        legal_terms_heading: "Terms & Conditions",
        legal_privacy_heading: "Privacy Policy",
    }
};

class I18n {
    constructor() {
        this.currentLang = localStorage.getItem('language') || 'de';
        this.currentLocale = this.detectLocale();
        document.documentElement.lang = this.currentLang;
    }

    detectLocale() {
        // Try to get from localStorage first
        const savedLocale = localStorage.getItem('locale');
        if (savedLocale) return savedLocale;

        // Detect from browser
        const browserLang = navigator.language || navigator.userLanguage;
        const langCode = browserLang.toLowerCase();
        
        // UK locales
        if (langCode.startsWith('en-gb') || langCode.startsWith('en-ie')) {
            return 'uk';
        }
        
        // US locale
        if (langCode.startsWith('en-us')) {
            return 'us';
        }
        
        // European countries (excluding UK)
        const europeanCountries = ['de', 'fr', 'it', 'es', 'nl', 'pl', 'pt', 'ro', 'hu', 'cs', 'sk', 'sl', 'bg', 'hr', 'el', 'fi', 'sv', 'da', 'no', 'et', 'lv', 'lt'];
        const langBase = langCode.split('-')[0];
        if (europeanCountries.includes(langBase)) {
            return 'eu';
        }
        
        // Default to US for other English speakers and non-European countries
        if (langCode.startsWith('en')) {
            return 'us';
        }
        
        // Default to US for unknown locales
        return 'us';
    }

    getCurrency() {
        switch (this.currentLocale) {
            case 'uk':
                return 'Â£';
            case 'us':
                return '$';
            case 'eu':
                return 'â‚¬';
            default:
                return '$';
        }
    }

    getPriceText() {
        const currency = this.getCurrency();
        // Base price is 2.99, adjust if needed for different currencies
        // For now, keeping 2.99 for all currencies (you can adjust conversion rates later)
        return `Then ${currency}2.99/Week`;
    }

    setLanguage(lang) {
        if (!translations[lang]) return;
        this.currentLang = lang;
        localStorage.setItem('language', lang);
        document.documentElement.lang = lang;
        this.updateContent();
        this.updateActiveState();
    }

    updateContent() {
        const elements = document.querySelectorAll('[data-i18n]');
        elements.forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (translations[this.currentLang][key] !== undefined) {
                let text = translations[this.currentLang][key];
                
                // Special handling for price_highlight to use locale-based currency
                if (key === 'price_highlight') {
                    text = this.getPriceText();
                }
                
                // If the element has children (like bold tags inside), we might need to be careful
                // For now, we assume simple text replacement or innerHTML if it contains HTML
                // Using innerHTML to allow for formatting if needed in translations
                element.innerHTML = text;
            }
        });
    }

    updateActiveState() {
        const buttons = document.querySelectorAll('.lang-btn');
        buttons.forEach(btn => {
            if (btn.dataset.lang === this.currentLang) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
    }

    init() {
        // Update locale on init (in case browser language changed)
        this.currentLocale = this.detectLocale();
        this.updateContent();
        // Create language switcher if it doesn't exist
        this.injectSwitcher();
    }
    
    injectSwitcher() {
        // Find a good place to inject the switcher. 
        // Maybe in the header or footer?
        // Let's look for the header or create a floating one if needed.
        // Ideally, the user of this script puts the placeholder in HTML, but we can append to body or header.
        
        // We'll append it to the header if it exists
        const header = document.querySelector('header');
        if (header && !document.querySelector('.lang-switcher')) {
            const switcher = document.createElement('div');
            switcher.className = 'lang-switcher';
            switcher.innerHTML = `
                <button class="lang-btn" data-lang="de" onclick="i18n.setLanguage('de')">DE</button>
                <span class="lang-separator">|</span>
                <button class="lang-btn" data-lang="en" onclick="i18n.setLanguage('en')">EN</button>
            `;
            header.appendChild(switcher);
            
            // Add styles for switcher
            const style = document.createElement('style');
            style.textContent = `
                .lang-switcher {
                    margin-left: auto;
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    font-size: 0.9rem;
                    z-index: 100;
                }
                .lang-btn {
                    background: none;
                    border: none;
                    cursor: pointer;
                    font-family: inherit;
                    opacity: 0.5;
                    padding: 2px 5px;
                    font-weight: bold;
                }
                .lang-btn.active {
                    opacity: 1;
                    text-decoration: underline;
                }
                .lang-separator {
                    opacity: 0.3;
                }
            `;
            document.head.appendChild(style);
        }
        
        this.updateActiveState();
    }
}

const i18n = new I18n();
// Initialize after DOM load
document.addEventListener('DOMContentLoaded', () => {
    i18n.init();
});

